# ============================================
# Frontend Dockerfile (Production - Build)
# ============================================

FROM node:20-alpine as builder

WORKDIR /app

# Копирование package files
COPY package*.json ./

# Установка зависимостей
RUN npm ci

# Копирование исходного кода
COPY . .

# Сборка production билда
RUN npm run build

# ============================================
# Production stage - только статика
# ============================================
FROM alpine:latest

# Копирование собранных файлов в /dist-built (НЕ в /app/dist, чтобы volume не перекрыл их)
COPY --from=builder /app/dist /dist-built

# CMD: копируем файлы из образа в volume, смонтированный на /app/dist
# Используем /dist-built, т.к. volume монтируется на /app/dist и перекрыл бы файлы там
CMD ["sh", "-c", "cp -rf /dist-built/. /app/dist/ && echo 'Frontend files copied to volume' && tail -f /dev/null"]
